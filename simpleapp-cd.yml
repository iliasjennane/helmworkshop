trigger:
  branches:
    include:
    - master
    - releases/*
    - feature/*
    exclude:
    - releases/old*
    - feature/*-working
  paths:
    include:
    - '*' 
    exclude:
    - '/simpleapp/simpleapi/*' 
    - '/simpleapp/simpleweb/*' 

resources:
- repo: self

pool:
  vmImage: 'ubuntu-latest'
stages:
- stage: 'Package'
  displayName: 'Package the helm chart'
  jobs:
   - job: PackageHelmChart
     steps:
       - task: HelmInstaller@1
         displayName: 'Install Helm'
         inputs:
           helmVersionToInstall: 'latest'

       - task: PowerShell@2
         inputs:
           targetType: 'filePath' 
           filePath: helmPackage.ps1
           arguments: -packageDestinationPath $(Build.ArtifactStagingDirectory) -chartSourcePath '/simpleapp/charts/simpleapp' -version '1.$(Build.BuildNumber)' -appVersion $(Build.BuildNumber)
           workingDirectory: $(Build.SourcesDirectory)

       - task: PublishBuildArtifacts@1
         displayName: 'publish simpleweb helm package for simpleweb as a pipeline artifact'
         inputs:
          PathtoPublish: '$(Build.ArtifactStagingDirectory)'
          ArtifactName: 'drop'
          publishLocation: 'Container'

